<?php $helper = $this->helper('Dotdigitalgroup\Email\Helper\Data'); ?>

<?php if($helper->getEasyEmailCapture()): ?>

    <script type="text/javascript">
        require(['jquery','domReady!'],function($){
            $("body").on("blur","input[name=username]", function(){
                var email = $(this).val();
                if(email && validateEmail(email)){
                    $.post( "<?php echo $helper->getEmailCaptureUrl(); ?>", { email: email} );
                }
            });
        });
        function validateEmail(sEmail) {
            var filter = /^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
            if (filter.test(sEmail))
                return true;
            else
                return false;
        }
    </script>
    
<?php endif; ?>